# Setup Guide

## Quick Setup (5 minutes)

### Step 1: Install Dependencies
```bash
pip install -r requirements.txt
```

### Step 2: Get the Dataset

**Option A: Download from Microsoft Research**
1. Visit: https://github.com/microsoft/msmarco/tree/main/MSRD
2. Download `movies.csv.gz`
3. Create directory structure:
```bash
mkdir -p msrd-dataset/msrd/dataset
```
4. Move file:
```bash
mv ~/Downloads/movies.csv.gz msrd-dataset/msrd/dataset/
```

**Option B: Use wget (if available)**
```bash
mkdir -p msrd-dataset/msrd/dataset
cd msrd-dataset/msrd/dataset
# Download link (check Microsoft Research for latest)
wget <download-url>
cd ../../..
```

### Step 3: Build Index
```bash
python -m film_search.cli build-index
```

Expected output:
```
Loading movies from msrd-dataset/msrd/dataset/movies.csv.gz...
Loaded 9700 movies
Building TF-IDF index...
Index built successfully
Saved to index/index.joblib
```

### Step 4: Test It
```bash
python -m film_search.cli search "comedy films in the 80s starring Eddie Murphy" -k 5
```

### Step 5: Launch Web App
```bash
streamlit run app.py
```

Open browser to: http://localhost:8501

## Detailed Setup

### System Requirements

- **Operating System**: macOS, Linux, or Windows
- **Python**: 3.9 or higher
- **RAM**: 2GB minimum (4GB recommended)
- **Disk Space**: 1GB for dataset and index

### Verify Python Version
```bash
python --version
# Should show: Python 3.9.x or higher
```

If not installed, download from: https://www.python.org/downloads/

### Create Virtual Environment (Recommended)
```bash
# Create virtual environment
python -m venv venv

# Activate it
# On macOS/Linux:
source venv/bin/activate
# On Windows:
venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt
```

### Verify Installation
```bash
# Check all packages installed
pip list | grep -E "pandas|scikit-learn|streamlit|rapidfuzz"

# Should show:
# pandas          2.x.x
# scikit-learn    1.x.x
# streamlit       1.x.x
# rapidfuzz       3.x.x
```

## Troubleshooting

### Issue: "No module named 'sklearn'"
**Solution**:
```bash
pip install scikit-learn
```

### Issue: "numpy version incompatible"
**Solution**:
```bash
pip install "numpy>=1.24.0,<2.0.0"
```

### Issue: "movies.csv.gz not found"
**Solution**: Verify file location:
```bash
ls msrd-dataset/msrd/dataset/movies.csv.gz
```
Should exist. If not, re-download dataset.

### Issue: "Index build fails with ParserError"
**Solution**: The CSV has embedded newlines. The code handles this with Python engine. If still fails:
```bash
# Verify file is not corrupted
gunzip -t msrd-dataset/msrd/dataset/movies.csv.gz
```

### Issue: "Streamlit command not found"
**Solution**:
```bash
# Install streamlit
pip install streamlit

# Or run with python -m
python -m streamlit run app.py
```

### Issue: "Port 8501 already in use"
**Solution**:
```bash
# Use different port
streamlit run app.py --server.port 8502
```

## Directory Structure After Setup

```
film_search_engine_deploy/
├── film_search/
│   ├── __init__.py
│   ├── cli.py
│   ├── data.py
│   ├── indexer.py
│   ├── query.py
│   └── search.py
├── msrd-dataset/
│   └── msrd/
│       └── dataset/
│           └── movies.csv.gz      # You download this
├── index/
│   └── index.joblib               # Generated by build-index
├── app.py
├── requirements.txt
├── README.md
├── SETUP.md
└── .gitignore
```

## Performance Tips

### Faster Index Loading
First query loads index from disk (~50ms). To keep it in memory:
```python
# In your code
from film_search.indexer import load_index
bundle = load_index()  # Load once
# Use bundle for multiple queries
```

### Reduce Memory Usage
If running on low-memory machine:
```python
# In film_search/indexer.py, reduce max_features
vectorizer = TfidfVectorizer(
    stop_words="english",
    max_features=50000,  # Reduced from 200000
    ngram_range=(1, 2)
)
```

### Speed Up Index Building
```python
# Use fewer n-grams
vectorizer = TfidfVectorizer(
    stop_words="english",
    max_features=200000,
    ngram_range=(1, 1)  # Only unigrams, faster
)
```

## Next Steps

1. **Try example queries** (see README.md)
2. **Explore the code** (start with `film_search/search.py`)
3. **Customize scoring** (adjust weights in `search.py`)
4. **Add more synonyms** (edit `film_search/query.py`)

## Getting Help

- Check README.md for usage examples
- Review code comments in `film_search/` modules
- Open an issue in the repository

Enjoy searching movies!
